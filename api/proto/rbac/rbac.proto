syntax = "proto3";

package vyomtech.rbac;

option go_package = "vyomtech-backend/api/proto/rbac";

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

// Role represents a role with permissions
message Role {
  string id = 1;
  string tenant_id = 2;
  string name = 3;
  string description = 4;
  repeated string permissions = 5;
  bool is_active = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp updated_at = 8;
}

// Permission represents a permission
message Permission {
  string id = 1;
  string tenant_id = 2;
  string code = 3;
  string description = 4;
  string category = 5;
  google.protobuf.Timestamp created_at = 6;
}

// CreateRoleRequest for creating a new role
message CreateRoleRequest {
  string tenant_id = 1;
  string name = 2;
  string description = 3;
  bool is_active = 4;
}

// CreateRoleResponse for role creation
message CreateRoleResponse {
  string role_id = 1;
  bool success = 2;
  string message = 3;
}

// GetRoleRequest for retrieving a role
message GetRoleRequest {
  string tenant_id = 1;
  string role_id = 2;
}

// GetRoleResponse for role retrieval
message GetRoleResponse {
  Role role = 1;
  repeated Permission permissions = 2;
}

// ListRolesRequest for listing roles
message ListRolesRequest {
  string tenant_id = 1;
  int32 limit = 2;
  int32 offset = 3;
}

// ListRolesResponse for role listing
message ListRolesResponse {
  repeated Role roles = 1;
  int32 total = 2;
}

// AssignPermissionsRequest for assigning permissions to a role
message AssignPermissionsRequest {
  string tenant_id = 1;
  string role_id = 2;
  repeated string permission_ids = 3;
}

// AssignPermissionsResponse for permission assignment
message AssignPermissionsResponse {
  bool success = 1;
  string message = 2;
  int32 assigned_count = 3;
}

// VerifyPermissionRequest for checking user permission
message VerifyPermissionRequest {
  string tenant_id = 1;
  int64 user_id = 2;
  string permission_code = 3;
}

// VerifyPermissionResponse for permission verification
message VerifyPermissionResponse {
  bool has_permission = 1;
  string message = 2;
}

// RBAC Service for role-based access control
// RoleTemplate represents a pre-built role template
message RoleTemplate {
  string id = 1;
  string tenant_id = 2;
  string name = 3;
  string description = 4;
  string category = 5;
  bool is_system_template = 6;
  bool is_active = 7;
  repeated string permission_ids = 8;
  string metadata = 9;
  google.protobuf.Timestamp created_at = 10;
  google.protobuf.Timestamp updated_at = 11;
}

// TemplateInstance represents a role created from a template
message TemplateInstance {
  string id = 1;
  string tenant_id = 2;
  string template_id = 3;
  string role_id = 4;
  int64 created_by = 5;
  string customizations = 6;
  google.protobuf.Timestamp created_at = 7;
}

// CreateRoleTemplateRequest for creating a role template
message CreateRoleTemplateRequest {
  string tenant_id = 1;
  string name = 2;
  string description = 3;
  string category = 4;
  bool is_system_template = 5;
  repeated string permission_ids = 6;
  string metadata = 7;
}

// CreateRoleTemplateResponse for role template creation
message CreateRoleTemplateResponse {
  string template_id = 1;
  bool success = 2;
  string message = 3;
}

// GetRoleTemplateRequest for retrieving a role template
message GetRoleTemplateRequest {
  string tenant_id = 1;
  string template_id = 2;
}

// ListRoleTemplatesRequest for listing role templates
message ListRoleTemplatesRequest {
  string tenant_id = 1;
  int32 page = 2;
  int32 page_size = 3;
}

// ListRoleTemplatesResponse for templates listing
message ListRoleTemplatesResponse {
  repeated RoleTemplate templates = 1;
  int32 total = 2;
}

// CreateRoleFromTemplateRequest for creating a role from a template
message CreateRoleFromTemplateRequest {
  string tenant_id = 1;
  string template_id = 2;
  string role_name = 3;
  string customizations = 4;
}

// CreateRoleFromTemplateResponse
message CreateRoleFromTemplateResponse {
  string role_id = 1;
  string instance_id = 2;
  bool success = 3;
  string message = 4;
}

service RBACService {
  // CreateRole creates a new role
  rpc CreateRole(CreateRoleRequest) returns (CreateRoleResponse);
  
  // GetRole retrieves a role with permissions
  rpc GetRole(GetRoleRequest) returns (GetRoleResponse);
  
  // ListRoles lists all roles for a tenant
  rpc ListRoles(ListRolesRequest) returns (ListRolesResponse);
  
  // AssignPermissions assigns permissions to a role
  rpc AssignPermissions(AssignPermissionsRequest) returns (AssignPermissionsResponse);
  
  // VerifyPermission checks if a user has a specific permission
  rpc VerifyPermission(VerifyPermissionRequest) returns (VerifyPermissionResponse);
  
  // GetUserPermissions retrieves all permissions for a user
  rpc GetUserPermissions(VerifyPermissionRequest) returns (ListPermissionsResponse);

  // CreateRoleTemplate creates a new role template
  rpc CreateRoleTemplate(CreateRoleTemplateRequest) returns (CreateRoleTemplateResponse);

  // GetRoleTemplate retrieves a role template
  rpc GetRoleTemplate(GetRoleTemplateRequest) returns (RoleTemplate);

  // ListRoleTemplates lists all role templates for a tenant
  rpc ListRoleTemplates(ListRoleTemplatesRequest) returns (ListRoleTemplatesResponse);

  // CreateRoleFromTemplate creates a role from a template
  rpc CreateRoleFromTemplate(CreateRoleFromTemplateRequest) returns (CreateRoleFromTemplateResponse);
}

// ListPermissionsResponse for permissions listing
message ListPermissionsResponse {
  repeated Permission permissions = 1;
  int32 total = 2;
}
